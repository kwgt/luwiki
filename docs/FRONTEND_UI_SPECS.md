# フロントエンドUI仕様

## 共通デザイン
  - カードの四隅のラウンドは最小化する
  - カードのシャドウは最小化させる

## フロントエンド設定
  - `config.toml` の `[frontend]` セクションでフォント関連を指定できる
  - 指定値は CSS の `font-family` としてそのまま使用する
  - 設定項目
      - `ui_font` : 画面全体のフォントファミリー
      - `md_font_sans` : Markdown設定のSans選択肢
      - `md_font_serif` : Markdown設定のSerif選択肢
      - `md_font_mono` : Markdown設定のMono選択肢
      - `md_code_font` : Markdownのコードブロック用フォントファミリー
        - 未指定の場合は `md_font_mono` を使用する
  - デフォルト値
      - `ui_font` = `sans-serif`
      - `md_font_sans` = `sans-serif`
      - `md_font_serif` = `serif`
      - `md_font_mono` = `monospace`
      - `md_code_font` = `monospace`

## 画面遷移
T.B.D

## 表示画面(通常画面)

### レイアウト
以下の様にレイアウトを設定する。

![通常画面レイアウト](./fig/view-page_overview.svg)

### コンポーネント

#### (1) ページタイトル領域
  - ページタイトルとして、本文のトップレベルセクション名を表示する。トップレベルセクションが設定されていない場合はパスの末尾エレメントを表示する。
  - 表示スタイルはH1またH2とし、通常テキストより大きく表示する
  - 領域に入りきらない場合はellipsisではみ出た部分を切り捨てる

#### (2) ページパス領域
  - ページパスに対するパンくずリストを作成し表示する
  - パンくずの各階層にそれぞれのリンクを設定する
  - 表示スタイルはリンクスタイルを維持する
  - 領域に入りきらない場合はellipsisではみ出た部分を切り捨てる

#### (3) 操作ボタン領域
  - リンクスタイルのボタンを列挙配置する
  - 配置するボタンは以下の通り
      - 編集 : 当該ページの編集画面への遷移
      - アセット追加 : アセットのアップロード
      - 移動 : ページパスの変更(リネーム)
      - 削除 : ページの削除
      - 情報表示 : ページのメタ情報のモーダル表示
      - 履歴 : 当該ページの履歴情報のモーダル表示
      - 差分 : 当該ページの各履歴の差分表示画面への遷移
      - 新規作成 : 新規ページの作成
      - 設定 : 表示設定の変更など

ボタンの配置は以下の様にする。

![通常画面レイアウト](./fig/view-page_buttons.svg)

なお、設定ボタンでは以下の設定を行うためのモーダルを表示させる。

 - 画面テーマ選択
 - Markdownレンダリングテーマ選択

#### (4) TOC
  - ページのトップレベルセクションを除くレベル2~4までのセクションに対するTOCを表示する
  - TOCのエントリは各章へのリンクを設定する

#### (5) 本文レンダリング領域
  - ページに設定されたMarkdownをレンダリングしたHTMLを表示させる

#### (6) アセット一覧
  - ページに付随するアセットの一覧を表示する
  - 表示内容はファイル毎に以下の情報をパックしてこれを一単位として表示する
      - ファイル名 : 最大16emまで。それ以上はellipsisで切り捨て
      - サイズ : 補助単位を用い幅を限定させる。例: "1,001KiB"など
      - 詳細表示ボタン : アイコン化リンク
      - ダウンロードボタン : アイコン化リンク
      - ファイル名コピーボタン : アイコン化リンク
      - 削除ボタン : アイコン化リンク
  - 列整列は行わず、アルファベット順に横方向に列挙させる。領域端に達したらラップし次の行へラップさせる。

### コンポーネントの配置
以下の図のように配置する。図中の番号とコンポーネントは以下の様に対応する。

  - (1) ページタイトル領域
  - (2) ページパス領域
  - (3) 操作ボタン領域
  - (4) TOC
  - (5) 本文レンダリング領域
  - (6) アセット一覧


```text
   +-------------------------+
   |           (1)           |
   +-------------------------+
   |           (2)           |
   +-------------------------+
   |           (3)           |
   +-----+-------------------+
   |     |                   |
   |     |                   |
   |     |                   |
   |     |                   |
   |     |                   |
   | (4) |        (5)        |
   |     |                   |
   |     |                   |
   |     |                   |
   |     +-------------------+
   |     |        (6)        |
   +-----+-------------------+

```

コンポーネント階層は以下の様に定義する。

  - ページビュー画面
      - ヘッダ領域
          - (1) ページタイトル領域
          - (2) ページパス領域
          - (3) 操作ボタン領域
      - ボディ領域
          - サイドパネル
              - (4) TOC
          - コンテンツパネル
              - (5) 本文レンダリング領域
              - (6) アセット一覧

なお、サイドパネルとコンテンツパネルの高さは一致させるようにすること。

### 共通状態
  - 対象: 操作可能な要素を含むコンポーネント（例: 操作ボタン領域、アセット一覧の各アイコン）
  - 読み込み中:
      - 対象コンポーネント全体をグレーアウト表示する
      - クリック/タップ操作はすべて無効化する
      - キーボード操作（フォーカス移動/実行）も無効化する
  - エラー発生時:
      - 対象コンポーネント全体をグレーアウト表示する
      - クリック/タップ操作はすべて無効化する
      - エラー内容はモーダルのポップアップ表示を行う

### その他
  - アセットの追加は以下の二通りの方法とする
      - アセット追加ボタンのクリック
      - 編集画面へのファイルのドラッグ＆ドロップ
  - アセットアップロード時にトーストを表示させ、そのトースト上でファイル名のクリップボードへのコピーを行うインタフェースを設ける。
  - アセットアップロードの挙動は表示画面と同一仕様とする。

## 編集画面

### レイアウト
画面サイズ毎に以下の様にレイアウトを設定する。

#### 画面サイズlg以上
![編集画面レイアウト(lg以上)](./fig/edit-page_layout-above-lg.svg)

#### 画面サイズmd以上
![編集画面レイアウト(md以上)](./fig/edit-page_layout-above-md.svg)

#### 画面サイズmd未満
![編集画面レイアウト(md未満)](./fig/edit-page_layout-under-md.svg)

### コンポーネント

#### (1) ページタイトル領域
  - ページタイトルとして、入力中の本文のトップレベルセクション名を表示する。トップレベルセクションが入力されていない場合はパスの末尾エレメントを表示する。
  - 表示スタイルはH1またH2とし、通常テキストより大きく表示する
  - 領域に入りきらない場合はellipsisではみ出た部分を切り捨てる

#### (2) ページパス領域
  - ページパスに対するパンくずリストを作成し表示する
  - 表示画面と異なりリンクは設定しない
  - 領域に入りきらない場合はellipsisではみ出た部分を切り捨てる

#### (3) 操作ボタン領域
  - リンクスタイルのボタンを列挙配置する
  - 配置するボタンは以下の通り
      - アセット追加 : アセットのアップロード
      - 保存 : 編集中のページの保存,このページの表示画面への遷移
      - キャンセル : 編集の終了,直前ページへの表示画面への遷移
  - 既存ページの編集時のみ、保存ボタン横に「(リビジョンを維持)」チェックボックスを表示する
      - チェックが有効な場合は保存時にリビジョン維持（amend）を指定する
      - ユーザが操作するまではチェック有りを初期状態とする
      - 文字差分が20文字超または行数差分が2行超の場合は自動でチェックを外す
      - ユーザがチェックを操作した場合は以後の自動変更は行わない
  - 未編集状態では保存ボタンを無効化し、文字色を `text-neutral-content` 相当にする

ボタンの配置は以下の様にする。

![編集画面レイアウト](./fig/edit-page_buttons.svg)

#### (4) TOC
  - 入力中のMarkdownから抽出された、レベル2~4までのセクションに対するTOCを表示する
  - TOCのエントリは各章へのリンクを設定する

#### (5) 本文編集領域
  - Markdown編集を行う領域
  - エディタを展開する

#### (6) アセット一覧
  - ページに付随するアセットの一覧を表示する
  - 表示画面と同じアイテムを列挙させる

#### (7) プレビュー領域
  - 入力中のMarkdownのリアルタイムレンダリングによるプレビュー表示を行う

#### (8) サイドパネル表示切り替えボタン
  - サイドパネルの表示・非表示を切り替えるボタンを、リンク形式のボタンで配置する
  - 画面サイズがmd以上の場合のみ表示

#### (9) プレビュー切り替えボタン
  - コンテンツパネルの表示を(5) + (6)にするか(7)にするかを切り替えるボタン
  - 画面サイズがlg未満の場合のみ表示

### コンポーネントの配置
画面サイズ毎に以下の図のように配置する。図中の番号とコンポーネントは以下の様に対応する。

  - (1) ページタイトル領域
  - (2) ページパス領域
  - (3) 操作ボタン領域
  - (4) TOC
  - (5) 本文編集領域
  - (6) アセット一覧
  - (7) プレビュー領域
  - (8) サイドパネル表示切り替えボタン
  - (9) プレビュー切り替えボタン

またコンポーネント階層は以下の様に定義する。

  - ページ編集画面
      - ヘッダ領域
          - (1) ページタイトル領域
          - (2) ページパス領域
          - (3) 操作ボタン領域
      - ボディ領域
          - 表示切替ボタン
              - (8) サイドパネル表示切り替えボタン
              - (9) プレビュー切り替えボタン 
          - サイドパネル
              - (4) TOC
          - コンテンツパネル
              - (5) 本文編集領域
              - (6) アセット一覧
              - (7) プレビュー領域

なお、サイドパネルとコンテンツパネルの高さは一致させるようにすること。

#### 画面サイズlg以上
```text

   +-------------------------+
   |           (1)           |
   +-------------------------+
   |           (2)           |
   +-------------------------+
   |           (3)           |
   +-------------------------+
    (8)
   +-----+-------------------+--------------------
   |     |                   |                   |
   |     |                   |                   |
   |     |                   |                   |
   |     |                   |                   |
   |     |        (5)        |                   |
   | (4) |                   |        (7)        |
   |     |                   |                   |
   |     |                   |                   |
   |     |                   |                   |
   |     +-------------------+                   |
   |     |        (6)        |                   |
   +-----+-------------------+-------------------+
```

#### 画面サイズmd以上
```text
   +-------------------------+
   |           (1)           |
   +-------------------------+
   |           (2)           |
   +-------------------------+
   |           (3)           |
   +-------------------------+
    (8)    (9)
   +-----+-------------------+
   |     |                   |
   |     |                   |
   |     |                   |
   |     |                   |
   |     |        (5)        |
   | (4) |                   |
   |     |                   |
   |     |                   |
   |     |                   |
   |     +-------------------+
   |     |        (6)        |
   +-----+-------------------+
```

#### 画面サイズmd未満
```text
   +-------------------+
   |        (1)        |
   +-------------------+
   |        (2)        |
   +-------------------+
   |        (3)        |
   +-------------------+
     (9)
   +-------------------+
   |                   |
   |                   |
   |                   |
   |                   |
   |        (5)        |
   |                   |
   |                   |
   |                   |
   |                   |
   +-------------------+
   |        (6)        |
   +-------------------+
```

### 共通状態
  - 対象: 操作可能な要素を含むコンポーネント（例: 操作ボタン領域、アセット一覧の各アイコン）
  - 読み込み中:
      - 対象コンポーネント全体をグレーアウト表示する
      - クリック/タップ操作はすべて無効化する
      - キーボード操作（フォーカス移動/実行）も無効化する
  - エラー発生時:
      - 対象コンポーネント全体をグレーアウト表示する
      - クリック/タップ操作はすべて無効化する
      - エラー内容はモーダルのポップアップ表示を行う

### その他
  - 編集対象パスに削除済みページ候補が存在する場合は、復活の選択肢を提示する
      - `GET /api/pages/deleted?path=...` で候補を取得する
      - 候補選択時は `GET /api/pages/{page_id}/source` で内容を表示する
      - 復活確定時は `POST /api/pages/{page_id}/path?restore_to=...` を呼び出す
  - アセットの追加は以下の二通りの方法とする
      - アセット追加ボタンのクリック
      - 表示画面へのファイルのドラッグ＆ドロップ
  - アセットアップロード時にトーストを表示させ、そのトースト上でファイル名のクリップボードへのコピーを行うインタフェースを設ける。
