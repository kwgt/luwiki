# Rustにおけるコーディング規約

## 基本事項
rustfmtによる標準的なコードフォーマットスタイルを定めた以下のRFCに則ります。

  - [RFC 0505](https://rust-lang.github.io/rfcs/0505-api-comment-conventions.html)
  - [RFC 1574](https://rust-lang.github.io/rfcs/1574-more-api-documentation-conventions.html)
  - [RFC 2436](https://rust-lang.github.io/rfcs/2436-style-guide.html)

ただし、以下のローカルルールを適用します。これに合わせてrustfmtの設定を事前に作成してください。

  - ソースコードの横幅の制限は80桁とします。
  - useの書き方ですが以下の規則に則ってください。
      - 標準ライブラリ, 公開パッケージ, ローカルクレートの順でグルーピングする
      - グループ間に改行を挿入し区分する
      - グループ内の各要素はアルファベット順にソートする
  - コメント記述種別の使い分けは以下の方針に則ること
    - 処理ステップを表すコメントはブロックコメントで記述すること
    - 処理に対する注釈はラインコメントで記述すること
  - 関数のサイズが15行を超える場合は、必ず処理の区切りごとにステップコメントを記述すること
  - 関数と同じく、1つのブロックのサイズが15行を超える場合でも、ブロック内で処理の区切り毎にステップコメントを記述すること
  - 上記ローカルルールは rustfmt.toml に明示すること
  - モジュールプライベートのワーク関数であってもドキュメントコメントの記述を行うこと
  - テスト関数を作成した場合は、ドキュメントコメントでテスト目的の記述を行うこと。また、テスト手順を「注記」に記述すること。
  - 原則として型（`struct`・`trait`・`enum`）に対する `impl` は、その型の責務を即座に把握できるよう、定義と物理的に近接した位置（同一ファイル・定義直後）に記述すること。ただし、以下のは例外として許容する。いずれの場合も分離理由をコメントで明示すること。
      - 可読性確保を目的としたモジュール分割により、サブモジュール（同一ファイル内または別ファイル）での `impl` によるメソッド定義
      - 多数の`#[cfg(test)]`の指定による煩雑化を避けるためのテスト用のメソッドの分割定義

### ドキュメントコメントの指針
ファイル先頭にはコピーライトヘッダを置き、以下の様なモジュール内容を要約したモジュールヘッダを記述してください。

```rust
//!
//! コマンドライン引数を取り扱うモジュール
//!
```

以下の様に、関数(メソッド)/enum/構造体のドキュメントコメントに対しては、先頭にと終端に"///"だけの行を付与し目立つようにしてください。

```rust
///
/// デフォルトのコンフィグレーションファイルのパス情報を生成
///
/// # 戻り値
/// コンフィギュレーションファイルのパス情報
///
fn default_config_path() -> PathBuf {
    DEFAULT_CONFIG_PATH.join("config.toml")
}
```

関数(メソッド)のドキュメントコメントについて、以下のセクションは必須とします。いずれも、単位が必要な場合は説明末尾に括弧書きで単位を表してください。

 - 引数(存在しない場合は記述しないでください)
 - 戻り値

エラーを返す関数で特記すべきことがある場合は戻り値のセクションに注記をお願いします。

関数のサイズが20行を超える場合は、「概要」セクションを設け処理内容の概要や関数の目的を記述してください。またミュータブルメソッドの場合で必要と思われる場合は呼び出しによって何が変更されるのかを明記してください。

### ステップコメントのスタイル
以下の様なスタイルで記述すること。

```rust
    /*
     * コマンドラインオプションのパース
     */
    let opts = match cmd_args::parse() {
        Ok(opts) => opts,
        Err(err) => {
            eprintln!("error: {}", err);
            std::process::exit(1);
        }
    };

    /*
     * 実行関数の実行
     */
    if let Err(err) = run(opts) {
        eprintln!("error: {}", err);
        std::process::exit(1);
    }
```

### コピーライトヘッダの雛形

コピーライトヘッダには以下の雛形を使用してください。

```rust
/*
 * Light weight and small wiki system for local use
 *
 *  Copyright (C) 2025 Hiroshi KUWAGATA <kgt9221@gmail.com>
 */
```
---

## エラー処理
- 原則として成否を返す関数・メソッドの戻り値は anyhow::Result で統一する
- 外部API境界では独自エラー型を定義してよい

---

## プロジェクトに関するコマンドで使用して良いもの

  - `cargo check` : ソースコードのチェック
  - `cargo build` : プロジェクトをビルドします
  - `cargo add` : 依存クレートの追加
  - `cargo test` : テストを実行します
  - `cargo run` : プログラムを実行します

プロジェクトの状態を変更しないコマンドについては制約を設けません。

## その他
  - 生成したコードはRustのコンパイル・警告・テストを考慮した構造とすること
  - ソースコードの変更時は可能な限り`cargo check`でコードチェックを行うこと
